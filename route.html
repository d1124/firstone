
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>测试 - layui</title>
  <link rel="stylesheet" href="layui/css/layui.css">

    <script src="jquery-1.12.4.js"></script>
<script src="Bmob-2.2.5.min.js"></script>
</head>
<body>

  <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
    <legend>批量处理事件</legend>
  </fieldset>
  <div class="layui-btn-container">
    <button class="layui-btn" lay-active="e1">初始化地区和三个班</button>
    <button class="layui-btn" lay-active="e2">初始化路线</button>
    <button class="layui-btn" lay-active="e3">路线和地区结合</button>
  </div>

  <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
    <legend>选择</legend>
  </fieldset>
  <div class="layui-btn-container">
    <button type="button" class="layui-btn" lay-demotransferactive="getData">发布当天任务</button>
    <button type="button" class="layui-btn" lay-demotransferactive="reload">自动选择</button>
  </div>
  <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
  <legend>A班</legend>
</fieldset>
<div id="test7" class="demo-transfer"></div>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
  <legend>B班</legend>
</fieldset>
<div id="test8" class="demo-transfer"></div>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
  <legend>C班</legend>
</fieldset>
<div id="test9" class="demo-transfer"></div>

<!-- 引入 layui.js 的 <script> 标签最好放置在 html 末尾 -->
<script src="layui/layui.js"></script>

<script>
layui.use(['transfer', 'layer', 'util'], function(){
  var $ = layui.$
  ,transfer = layui.transfer
  ,layer = layui.layer
  ,util = layui.util;

// Bmob.initialize("2ba7d49d6cd824c5", "981124");
Bmob.initialize("f1cdf3c708bde14d", "981124");
var data1 = [
{"value": "1001", "title": "李白","time":"1"}
,{"value": "2001", "title": "李白","time":"2"}
,{"value": "3001", "title": "李白","time":"3"}
,{"value": "1002", "title": "杜甫","time":"1"}
,{"value": "1003", "title": "苏轼","time":"1"}
,{"value": "1004", "title": "李清照","time":"2"}
,{"value": "1005", "title": "鲁迅","time":"1"}
,{"value": "1006", "title": "巴金","time":"1"}
,{"value": "1007", "title": "冰心","time":"1"}
,{"value": "1008", "title": "矛盾","time":"1"}
,{"value": "1009", "title": "贤心","time":"1"}
]

//实例调用
transfer.render({
  elem: '#test7'
  ,showSearch: true
  ,data: data1
  ,parseData: function(res){
  return {
    "value": res.value //数据值
    ,"title": res.title+"("+res.time+")" //数据标题
    ,"disabled": res.disabled  //是否禁用
    ,"checked": res.checked //是否选中
  }
}
  ,title: ['全部地点', 'A班选中地点']
  ,id: 'key1' //定义唯一索引
  ,value: ["1001", "2001", "3001"]
})

transfer.render({
  elem: '#test8'
  ,showSearch: true
  ,data: data1
  ,parseData: function(res){
  return {
    "value": res.value //数据值
    ,"title": res.title+"("+res.time+")" //数据标题
    ,"disabled": res.disabled  //是否禁用
    ,"checked": res.checked //是否选中
  }
}
  ,title: ['全部地点', 'B班选中地点']
  ,id: 'key2' //定义唯一索引
  ,value: ["1002", "1004", "1006"]
})


transfer.render({
  elem: '#test9'
  ,showSearch: true
  ,data: data1
  ,parseData: function(res){
  return {
    "value": res.value //数据值
    ,"title": res.title+"("+res.time+")" //数据标题
    ,"disabled": res.disabled  //是否禁用
    ,"checked": res.checked //是否选中
  }
}
  ,title: ['全部地点', 'C班选中地点']
  ,id: 'key3' //定义唯一索引
  ,value: ["1007", "1008", "1009"]
})



// 批量办法定事件
util.event('lay-demoTransferActive', {
  getData: function(othis){

    var getData = transfer.getData('key1'); //获取右侧数据
    // layer.alert(JSON.stringify(getData));
    // var Data1=JSON.stringify(getData);
    for(var i = 0 ; i < getData.length ; i++){
    var place=getData[i]["title"];
    var time=getData[i]["value"];
  }
    // str.slice(0,-3);
    // layer.alert(str.slice(0,-3));
    layer.alert(time.slice(0,1)+"-"+place.slice(0,-3)+getData.length);


  }
  ,reload:function(){
    //实例重载
    transfer.reload('key1', {
      value: ['1002', '1005', '1003']
      ,showSearch: true
      ,parseData: function(res){
      return {
        "value": res.value //数据值
        ,"title": res.title //数据标题
        ,"disabled": res.disabled  //是否禁用
        ,"checked": res.checked //是否选中
      }
    }
    })
    transfer.reload('key2', {
      value: ['1001', '1002', '1001']
      ,showSearch: true
      ,parseData: function(res){
      return {
        "value": res.value //数据值
        ,"title": res.title //数据标题
        ,"disabled": res.disabled  //是否禁用
        ,"checked": res.checked //是否选中
      }
    }
    })
    transfer.reload('key3', {
      value: ['1002', '1006', '1007']
      ,showSearch: true
      ,parseData: function(res){
      return {
        "value": res.value //数据值
        ,"title": res.title //数据标题
        ,"disabled": res.disabled  //是否禁用
        ,"checked": res.checked //是否选中
      }
    }
    })
  }
});

window.Array1;
//处理属性 为 lay-active 的所有元素事件
util.event('lay-active', {
  e1: function(){
    layer.msg('初始化地区');
    const queryArray = new Array();
for(var i = 0 ; i < 3 ; i++){
  var queryObj = Bmob.Query('Data');
  queryObj.set('place','李白');
  queryObj.set('Date','2021-05-18');
  queryObj.set('classname','早');
  queryArray.push(queryObj);
  // var queryObj2 = Bmob.Query('Data');
  // queryObj2.set('place','abc' + i);
  // queryObj2.set('Date','2021-05-18');
  // queryObj2.set('classname','中');
  // queryArray.push(queryObj2);
  // var queryObj3 = Bmob.Query('Data');
  // queryObj3.set('place','abc' + i);
  // queryObj3.set('Date','2021-05-18');
  // queryObj3.set('classname','晚');
  // queryArray.push(queryObj3);
  window.Array1=queryArray;
}
window.Array3= new Array();
// 传入刚刚构造的数组
Bmob.Query('Data').saveAll(queryArray).then(result => {
  // console.log(result);
  // console.log(result[1]["success"]["objectId"]);
  const Array2 = new Array();
  for(var i = 0 ; i < result.length ; i++){
    var Obj=new Object();
    Obj.place=Array1[i]["setData"]["place"];
    Obj.Id=result[i]["success"]["objectId"];
    Array2.push(Obj);
  }
  // console.log(Array2);
  window.Array3=Array2;
    console.log(Array3);
}).catch(err => {
  console.log(err);
});



  }
  ,e2: function(){
    layer.msg('触发了事件2');
    var getData = transfer.getData('key1'); //获取右侧数据
    // layer.alert(JSON.stringify(getData));
    // var Data1=JSON.stringify(getData);

    const queryArray = new Array();
    for(var i = 0 ; i < getData.length ; i++){
    var place=getData[i]["title"].slice(0,-3);
    var time=getData[i]["value"].slice(0,1);
    var queryData = Array3.filter(function (_data) {
            return _data.place == place
            // return _data.place == 'abc1'
        });
    // if(queryData!=null)console.log(queryData[0]["Id"]);
    var Id=queryData[0]["Id"];
    // var str_ID=JSON.stringify(Id);
    // console.log(Id);
    // console.log(queryData[0]["Id"]);
    var queryObj = Bmob.Query('Task');
    queryObj.set('placename',place);
    queryObj.set('timenum',time);
    queryObj.set('DataID',Id);
    queryArray.push(queryObj);
  }

   // console.log(queryArray);
    // str.slice(0,-3);
    // layer.alert(str.slice(0,-3));
    // layer.alert(time.slice(0,1)+"-"+place.slice(0,-3)+getData.length);

    Bmob.Query('Task').saveAll(queryArray).then(result => {
    }).catch(err => {
      console.log(err);
    });

  }
  ,e3: function(){
    layer.msg('触发了事件3');
  }
});


});
</script>
</body>
</html>
